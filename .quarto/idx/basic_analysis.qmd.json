{"title":"Microbiota Analysis","markdown":{"yaml":{"title":"Microbiota Analysis","author":"Sudarshan A. Shetty","date":"`r Sys.Date()`","format":{"html":{"code-tools":true,"code-fold":false,"code-copy":true,"self-contained":true,"toc-location":"left"}},"knitr":{"opts_chunk":{"collapse":true,"dpi":150,"message":false,"warning":false,"error":true}},"editor":"visual","params":{"pseq_path":"pseq_path","primary_var":"primary_var"}},"headingText":"Load libraries","containsRefs":false,"markdown":"\n\nIn this document, we investigate whether the Shannon diversity and Observed ASVs of samples is correlated to their sequencing depth.  \n\n\n```{r}\nlibrary(phyloseq)\nlibrary(microbiome)\nlibrary(ggpubr) # stats with viz\nlibrary(patchwork) # combine plots \n```\n\n## Define parameters\n\n```{r}\npseq_path = params$pseq_path\nprimary_var = params$primary_var\n```\n\n## Read Data\n\n```{r}\npseq <- readRDS(pseq_path)\n```\n\n## Check Reads\n\n```{r fig.height=4, fig.width=5, fig.align='center'}\n# add reads/sample to sample_data()\nsample_data(pseq)$reads.per.sample <- sample_sums(pseq)\n# Compare between groups\npseq |> \n    microbiome::meta() |> \n    ggplot(aes_string(primary_var, \"reads.per.sample\")) +\n    geom_violin(aes_string(color=primary_var))+\n    geom_boxplot(aes_string(color=primary_var), width=0.2) +\n    labs(x=\"\", y=\"Reads/sample\")+\n    theme_bw()\n```\n\n\n## Alpha diversity\n\n```{r fig.height=4, fig.width=8, fig.align='center'}\n# we can add shannon diversity to sample_data(pseq)\nsample_data(pseq)$shannon <- microbiome::diversity(pseq, index=\"shannon\")[,1]\nsample_data(pseq)$observed <- microbiome::richness(pseq, index=\"observed\")[,1]\np.shannon <- meta(pseq) |> \n    ggplot(aes_string(primary_var, \"shannon\")) +\n    geom_violin(aes_string(color=primary_var))+\n    geom_boxplot(aes_string(color=primary_var), width=0.2) +\n    labs(x=\"\", y=\"Shannon Diversity\")+\n    theme_bw()\np.observed <- meta(pseq) |> \n    ggplot(aes_string(primary_var, \"observed\")) +\n    geom_violin(aes_string(color=primary_var))+\n    geom_boxplot(aes_string(color=primary_var), width=0.2) +\n    labs(x=\"\", y=\"Observed ASVs\")+\n    theme_bw()\n\n(p.shannon | p.observed ) + \n    plot_layout(guides = \"collect\") +\n    plot_annotation(tag_levels = \"a\")\n```\n\n## Correlation\n\nCheck if reads per sample is correlated to Shannon diversity and Observed ASVs.  \n\n```{r fig.height=4, fig.width=8, fig.align='center'}\np.shanon.cor <- meta(pseq) |> \n    ggplot(aes_string(\"reads.per.sample\", \"shannon\", group=primary_var)) +\n    geom_point(aes_string(color=primary_var), alpha=0.5) +\n    geom_smooth(method = \"lm\", aes_string(color=primary_var), show.legend = FALSE) +\n    ggpubr::stat_cor(method = \"spearman\", aes_string(color=primary_var), show.legend = FALSE,\n                     label.x.npc = 0.5, label.y.npc = 0.3, hjust = 0)+\n    labs(x=\"Reads/sample\", y=\"Shannon Diversity\") +\n    theme_bw() \n\np.observed.cor <- meta(pseq) |> \n    ggplot(aes_string(\"reads.per.sample\", \"observed\", group=primary_var)) +\n    geom_point(aes_string(color=primary_var), alpha=0.5) +\n    geom_smooth(method = \"lm\", aes_string(color=primary_var), show.legend = FALSE) +\n    ggpubr::stat_cor(method = \"spearman\", aes_string(color=primary_var), show.legend = FALSE,\n                     label.x.npc = 0.5, label.y.npc = 0.3, hjust = 0) +\n    labs(x=\"Reads/sample\", y=\"Observed ASVs\") +\n    theme_bw() \n\n\n(p.shanon.cor | p.observed.cor) + \n    plot_layout(guides = \"collect\") +\n    plot_annotation(tag_levels = \"a\")\n```\n\n\n```{r}\nsessionInfo()\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":false,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"self-contained":true,"output-file":"basic_analysis.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","comments":{"utterances":{"repo":"microsud/quarto_microbiome"}},"body-header":"Â© Copyright 2023 Sudarshan A. Shetty\n","editor":"visual","theme":{"light":"flatly","dark":"darkly"},"title":"Microbiota Analysis","author":"Sudarshan A. Shetty","date":"`r Sys.Date()`","knitr":{"opts_chunk":{"collapse":true,"dpi":150,"message":false,"warning":false,"error":true}},"params":{"pseq_path":"pseq_path","primary_var":"primary_var"},"code-copy":true,"toc-location":"left"},"extensions":{"book":{"multiFile":true}}}}}